<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual Network Lab - jlcrc.cloud</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wdth,wght@0,95,100..900;1,95,100..900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    
    <header>
      <nav class="navbar">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="cv.html">CV</a></li>
          <li><a href="cloudresumechallenge.html">Cloud Resume Challenge</a></li>     
          <li><a href="projects.html">Projects</a></li>          
        </ul>
      </nav>
    </header>
    
    <section class="netlab-section">
      
      <p>
        <b><i><a href="projects.html">Back to Projects page</a></i></b>
      </p>
      
      <h1>Virtual Network Lab</h1>

      <p>
        A virtualized network environment built for testing, learning, and automation, secured with nftables, segmented via a LAN bridge, including automated file backups. Powered by QEMU/KVM and managed through a dedicated Debian admin workstation VM.
      </p>
      
      <p>
        <h4>Overview</h4><br>
        This HomeLab simulates an internal network with routing, file sharing, firewalls, and client/server interactions. All virtual machines are hosted on a Linux machine using QEMU/KVM and connected through a bridged virtual LAN. Itâ€™s built for practical experience with Linux system administration, networking, and infrastructure automation.
      </p>

      <p>
        <h4>Architecture</h4>
        <ul>
          <li><b>Virtualization:</b> QEMU/KVM (Pop_OS! Linux host)</li>
          <li><b>Bridge Interface:</b> br0 for internal LAN</li>
          <li><b>Firewall:</b> nftables (default drop, allow-by-policy)</li>
          <li><b>DHCP/DNS:</b> dnsmasq (router01 VM)</li>
          <li><b>Automation:</b> anacron</li>
          <li><b>Backups:</b> Daily file backups</li>
        </ul>
      </p>

      <p>
        <h4>VM Inventory</h4>
        <ul>
          <li><b>router01:</b> Gateway, DHCP/DNS; Debian (no GUI)<br></li>
          <li><b>fileserver01:</b> NFS/SMB host, file sharing; Ubuntu Server (Minimized)<br></li>
          <li><b>monitor01:</b> Monitoring, Prometheus & Grafana; Ubuntu Server (Minimized)<br></li>
          <li><b>admin01:</b> Central Workstation; Debian, XFCE<br></li>
          <li><b>linuxclient01:</b> Linux Client; AlmaLinux 10 (Minimal)<br></li>
          <li><b>windowsclient01:</b> Windows Client; Windows 10<br></li>
        </ul>
      </p>

      <p>
        <h4>General Rules (nftables)</h4>
        <ul>
          <li>All input/forward chains use default drop</li>
          <li>SSH to all VMs from admin01</li>
          <li>Traffic allowed only as needed by role:</li>
          <ul>
            <li><b>router01:</b> DNS, DHCP, SSH (port 2222), LAN-WAN forwarding, NAT masquerade</li>
          </ul>
          <ul>
            <li><b>fileserver01:</b></li>
            <ul>
              <li>Samba: TCP 445</li>
              <li>NFS: TCP/UDP 111, 2049, 32765-32767</li>
              <li>Ping: ICMP echo request from LAN</li>
            </ul>
          </ul>
          <ul>
            <li><b>monitor01</b></li>
            <ul>
              <li>Grafana from admin01, port 3000</li>
              <li>Prometheus from admin01, port 9091</li>
            </ul>
          </ul>
        </ul>
      </p>

      <p>
        <h4>Networking</h4>
        <ul>
          <li><b>Subnet:</b> 192.168.100.0/24</li>
          <li><b>Gateway:</b> 192.168.100.1 (router01)</li>
          <li><b>DHCP Range:</b> 192.168.100.10-100 (12h lease)</li>
          <li><b>Static Leases: linuxclient01 (.101), windowsclient01 (.102)</b></li>
        </ul>
      </p>

      <p>
        <h4>File Sharing</h4>
        <ul>
          <li><b>NFS Share</b> (fileserver01): /srv/nfsshare, mounted at /mnt/nfsshare on linuxclient01</li>
          <li><b>Samba Share</b> (fileserver01): /srv/smbshare, mapped as :Z on windowsclient0
        </ul>        
      </p>

      <p>
        <h4>Backups</h4>
        <ul>
        <li><b>Anacron</b> jobs run on fileserver01:</li>
          <ul>
            <li>Scripts on fileserver01 scheduled with anacron</li>            
            <li>.tar.gz archives, timestamped</li>
            <li>Stored locally, timestamped logs written to /var/log/backups</li>
          </ul>
        </ul>
      </p>

      <p>
        <h4>Monitoring</h4>
        <ul>
          <li><b>Prometheus</b> and <b>Grafana</b> containerized with <b>docker compose</b> on <b>monitor01</b></li>
          <ul>
            <li>Ports: Prometheus 9091, Grafana 3000</li>
          </ul>        
          <li><b>node_exporter</b> on Linux VMs (9100), <b>windows_exporter</b> on Windows (9182)</li>          
        </ul>
      </p>

      <p>
        <h4>Admin Workflow</h4>
        <ul>
          <li>Use admin01 (GUI) to SSH into headless VMs</li>
          <li>VMs maintain key-only access where applicable</li>
        </ul>
      </p>

      <p>
        <h4>Future improvements, taking it further</h4>
        <ul>
          <li>Grafana alerts, dashboard tuning</li>
          <li>VPN access, remote lab control</li>
          <li>Simulated network printer</li>
          <li>Ansible playbooks for automation</li>
          <li>Dedicated backups VM or cloud backups (e.g. Amazon S3)</li>
          <li>Central LDAP authentication</li>
        </ul>
      </p>

      <p>
        <h4>Key Learning & Practice Areas</h4>
        <ul>
          <li>subnetting & DHCP leases with dnsmasq</li>
          <li>nftables & rulesets</li>
          <li>Secure SSH config</li>
          <li>Using Prometheus & Grafana</li>
          <li>Using Docker</li>
          <li>Filesharing with NFS & Samba</li>
          <li>Bash scripting for backup automation</li>
          <li>Troubleshooting networking</li>
        </ul>
      </p>

      <p>
        <h4>Problems & Learning Experiences</h4>
        <p>
          <b>Host Bridge Issues</b>
          <ul>
            <li>VMs not connecting to host bridge device properly</li>
            <li>Fixed by assigning 192.168.100.254/24 to bridge device and 192.168.100.1 as gateway & DNS</li>
          </ul>
        </p>
        <p>
          <b>No internet on linuxclient01</b>
          <ul>
            <li>DHCP worked, router01 pinged, but no external access</li>
            <li>Port forwarding wasn't permanently enabled on router01 
              (missing ipv4.ip_forward = 1 in sysctl.conf)
            </li>
          </ul>
        </p>
        <p>
          <b>Switched from iptables to nftables</b>
          <ul>
            <li>Learned nftables is the modern replacement, switched to it</li>
            <li>Cleaner & better design</li>
          </ul>
        </p>
        <p>
          <b>Docker snap weirdness</b>
          <ul>
            <li>Initial install of Docker via snap on monitor01 had issues</li>
            <li>Replaced with docker.io from apt</li>
          </ul>
        </p>
        <p>
          <b>I actually created admin01 late</b>
          <ul>
            <li>Originally using router01 as central workstation</li>
            <li>Set up admin01 as central GUI workstation, set up Grafana</li>
          </ul>
        </p>
        <p>
          <b>Docker containers stuck restarting</b>
          <ul>
            <li>Fixed by setting correct volume directory permissions</li>
            <li>Grafana: 472:472, Prometheus: 65534:65534</li>            
          </ul>
        </p>
        <p>
          <b>Prometheus unreachable from Grafana</b>
          <ul>
            <li>Initially tried connecting Grafana to Prometheus as a data source 
              at monitor01's IP address, port 9091</li>
            <li>Realized Grafana & Prometheus are on the same Docker network, 
              used internal path instead of host IP and port</li>
          </ul>
        </p>
        <p>
          <b>Trouble accessing smbshare on fileserver01 from windowsclient01</b>
          <ul>
            <li>fileserver01 pinged, but \\fileserver01\smbshare network drive mapping failed</li>
            <li>Found sharename typo in smb.conf, fixed it</li>            
          </ul>
        </p>
        <p>
          <b>linuxclient01 backup problems</b>
          <ul>
            <li>Added static DHCP lease to linuxclient01 to ensure consistent IP for SSH-based backups</li>
          </ul>
        </p>
      </p>


    <p>
      <b><i><a href="projects.html">Back to Projects page</a></i></b>
    </p>

    </section>

    <footer class="site-footer">
      <p>&copy; 2025 Jericho. All rights reserved.</p>
    </footer>
    
  </div>
</body>
</html>
